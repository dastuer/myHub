-- MySQL dump 10.13  Distrib 8.0.26, for Win64 (x86_64)
--
-- Host: 113.31.166.52    Database: myhub
-- ------------------------------------------------------
-- Server version	8.0.21

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!50503 SET NAMES gbk */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `comment`
--

DROP TABLE IF EXISTS `comment`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `comment` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `parent_id` bigint NOT NULL,
  `commenter` int NOT NULL,
  `type` smallint NOT NULL,
  `gmt_create` bigint DEFAULT NULL,
  `gmt_modify` bigint DEFAULT NULL,
  `like_count` bigint DEFAULT '0',
  `content` varchar(1024) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `comment`
--

LOCK TABLES `comment` WRITE;
/*!40000 ALTER TABLE `comment` DISABLE KEYS */;
/*!40000 ALTER TABLE `comment` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `flyway_schema_history`
--

DROP TABLE IF EXISTS `flyway_schema_history`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `flyway_schema_history` (
  `installed_rank` int NOT NULL,
  `version` varchar(50) DEFAULT NULL,
  `description` varchar(200) NOT NULL,
  `type` varchar(20) NOT NULL,
  `script` varchar(1000) NOT NULL,
  `checksum` int DEFAULT NULL,
  `installed_by` varchar(100) NOT NULL,
  `installed_on` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `execution_time` int NOT NULL,
  `success` tinyint(1) NOT NULL,
  PRIMARY KEY (`installed_rank`),
  KEY `flyway_schema_history_s_idx` (`success`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `flyway_schema_history`
--

LOCK TABLES `flyway_schema_history` WRITE;
/*!40000 ALTER TABLE `flyway_schema_history` DISABLE KEYS */;
INSERT INTO `flyway_schema_history` VALUES (1,'1','Create user table','SQL','V1__Create_user_table.sql',-106703621,'root','2021-08-26 21:11:37',56,1),(2,'2','Create question table','SQL','V2__Create_question_table.sql',789553707,'root','2021-08-26 21:11:38',12,1),(3,'3','Add avatar to table user','SQL','V3__Add_avatar_to_table_user.sql',408068770,'root','2021-08-26 21:11:38',33,1),(4,'4','Create unique index accountId on table user','SQL','V4__Create_unique_index_accountId_on_table_user.sql',1397104999,'root','2021-08-26 21:11:38',18,1),(5,'5','Create table comment','SQL','V5__Create_table_comment.sql',808840110,'root','2021-08-26 21:11:38',11,1),(6,'6','Alter tables id','SQL','V6__Alter_tables_id.sql',-1695863193,'root','2021-08-26 21:11:38',40,1),(7,'7','Create table notify','SQL','V7__Create_table_notify.sql',-1009642346,'root','2021-08-26 21:11:38',38,1),(8,'8','Alter Table notify field outerId','SQL','V8__Alter_Table_notify_field_outerId.sql',1170101666,'root','2021-08-26 21:11:38',14,1),(9,'9','Alter Table notify add field outerTitle','SQL','V9__Alter_Table_notify_add_field_outerTitle.sql',1686656461,'root','2021-08-26 21:11:38',10,1),(10,'10','Alter Table User Add Field unread','SQL','V10__Alter_Table_User_Add_Field_unread.sql',-1286106116,'root','2021-08-26 21:11:38',12,1),(11,'11','Create Table ObjectKeys','SQL','V11__Create_Table_ObjectKeys.sql',-755947363,'root','2021-08-26 21:11:38',13,1),(12,'12','Create Table Great','SQL','V12__Create_Table_Great.sql',-1351386563,'root','2021-08-29 13:57:13',80,1),(13,'13','Alter Table Great Create Primary New Key','SQL','V13__Alter_Table_Great_Create_Primary_New_Key.sql',1414820048,'root','2021-08-29 13:57:13',38,1),(14,'14','Alter Table Question Colunm Description To Longtext','SQL','V14__Alter_Table_Question_Colunm_Description_To_Longtext.sql',1867099803,'root','2021-08-29 20:31:28',172,1);
/*!40000 ALTER TABLE `flyway_schema_history` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `great`
--

DROP TABLE IF EXISTS `great`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `great` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `user_id` int NOT NULL,
  `like_id` bigint NOT NULL,
  `type` smallint NOT NULL DEFAULT '0',
  `status` smallint NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `great_pk` (`user_id`,`like_id`,`type`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `great`
--

LOCK TABLES `great` WRITE;
/*!40000 ALTER TABLE `great` DISABLE KEYS */;
INSERT INTO `great` VALUES (1,1,8,1,1),(2,1,6,2,1),(3,1,6,1,1),(4,2,8,1,1),(5,2,8,2,1),(6,1,8,2,1);
/*!40000 ALTER TABLE `great` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `notify`
--

DROP TABLE IF EXISTS `notify`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `notify` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `notifier` int NOT NULL,
  `receiver` int NOT NULL,
  `outer_id` bigint NOT NULL,
  `type` smallint NOT NULL,
  `gmt_create` bigint NOT NULL,
  `status` smallint NOT NULL DEFAULT '0',
  `outer_title` varchar(100) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `notify`
--

LOCK TABLES `notify` WRITE;
/*!40000 ALTER TABLE `notify` DISABLE KEYS */;
/*!40000 ALTER TABLE `notify` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `objectKeys`
--

DROP TABLE IF EXISTS `objectKeys`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `objectKeys` (
  `key` varchar(200) NOT NULL,
  `que_id` bigint NOT NULL,
  PRIMARY KEY (`key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `objectKeys`
--

LOCK TABLES `objectKeys` WRITE;
/*!40000 ALTER TABLE `objectKeys` DISABLE KEYS */;
/*!40000 ALTER TABLE `objectKeys` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `question`
--

DROP TABLE IF EXISTS `question`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `question` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `title` varchar(50) NOT NULL,
  `creator` int NOT NULL,
  `description` longtext NOT NULL,
  `comment_count` int DEFAULT '0',
  `view_count` int DEFAULT '0',
  `like_count` int DEFAULT '0',
  `tag` varchar(250) DEFAULT NULL,
  `gmt_create` bigint DEFAULT NULL,
  `gmt_modify` bigint DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `question`
--

LOCK TABLES `question` WRITE;
/*!40000 ALTER TABLE `question` DISABLE KEYS */;
INSERT INTO `question` VALUES (4,'centos 上服务器部署(持续更新中)',1,'## 项目部署用到的命令\r\n\r\n### 1. 修改数据库密码\r\n\r\n```sql\r\nALTER USER \'root\'@\'localhost\' IDENTIFIED WITH MYSQL_NATIVE_PASSWORD BY \'12345678\'\r\n```\r\n\r\n### 2. centos找到Java路径\r\n```bash\r\nwhich java\r\n```\r\n\r\n### 3. 查看端口占用\r\n\r\n`netstat -nap` #会列出所有正在使用的端口及关联的进程/应用\r\n`lsof -i :portnumber` #portnumber要用具体的端口号代替，可以直接列出该端口听使用进程/应用\r\n\r\n### 4. 检查端口被哪个进程占用\r\n\r\n`netstat -lnp|grep 88`  #88请换为你的apache需要的端口，如：80\r\n\r\n### 5. 关闭进程\r\n\r\n`ps -ef `查看所有进程。找到进程号后`kill`关闭\r\n### 6. ssh连接关闭后服务器继续运行\r\n\r\n使用命令 nohup\r\n\r\n```bahs\r\nnohup [comd]\r\n```\r\n\r\n 查看日志\r\n\r\n```bash\r\n# 跟踪log文件的内容\r\ntail -f <your log file>\r\n```\r\n\r\n',0,224,0,'linux,centos,mysql,java',1630079325539,1630158065273),(7,'如何高效学习java',1,'## 1. \r\n## 2. \r\n## 3. \r\n## 4.\r\n## ......',0,16,0,'perl,erlang,rust',1630160790176,1630160790176),(8,'Myhub社区点赞系统设计',1,'# Myhub点赞系统设计\r\n## 1. 总体思路\r\n ![](http://myhub-1307157181.cos.ap-chengdu.myqcloud.com/4d528e30-9ac7-4c96-9cdd-99b49c31286a%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6.jpg)\r\n## 2. 前端设计\r\n- 前端利用不同的图片标记不同的点赞状态\r\n点赞:![](http://myhub-1307157181.cos.ap-chengdu.myqcloud.com/ad9d29e1-14e3-45c8-866e-2345a9d759fcis-like-active.png)\r\n未点赞:![](http://myhub-1307157181.cos.ap-chengdu.myqcloud.com/3ceec400-5e3e-4510-a3dc-4b93472bf573is-like.png)\r\n页面:\r\n\r\n```html\r\n<img  class=\"like\" id=\"isLike\" th:attr=\"status=${question.isLike},likeId=${question.id}\" onclick=\"submit_question_like()\"th:src=\"${(session.user!=null&&question.isLike==1)?\'/images/is-like-active.png\':\'/images/is-like.png\'}\" alt=\"#\">\r\n```\r\n\r\n点赞控制\r\n```js\r\nfunction submit_question_like() {\r\n    let isLike = $(\"#isLike\");\r\n    let status = isLike.attr(\"status\");\r\n    // 防止连续点击\r\n    let lastClick = window.localStorage.getItem(\"lastClick\");\r\n    if (lastClick==null) {\r\n        window.localStorage.setItem(\"lastClick\", (new Date().getTime()).toString());\r\n    }else {\r\n        let now = new Date().getTime();\r\n        let lastTime = Number(lastClick);\r\n        window.localStorage.setItem(\"lastClick\",now.toString());\r\n        // console.log(\"now:\"+now+\",\"+\"lastTime:\"+lastTime)\r\n        if (now-lastTime < 300){\r\n            window.localStorage.setItem(\"lastClick\",now.toString());\r\n            return;\r\n        }\r\n    }\r\n    let  questionLikeCount = $(\"#questionLikeCount\");\r\n    // 切换图标,发送请求\r\n    if(status===\'1\'){\r\n        isLike.attr(\"src\",\"/images/is-like.png\");\r\n        isLike.attr(\"status\",\'0\');\r\n        // 同步点赞数\r\n        questionLikeCount.text(Number(questionLikeCount.text())-1);\r\n    }else if (status===\'0\') {\r\n        isLike.attr(\"src\",\"/images/is-like-active.png\");\r\n        isLike.attr(\"status\",\'1\');\r\n        questionLikeCount.text(Number(questionLikeCount.text())+1);\r\n    }\r\n    post_like(1,Number(isLike.attr(\"likeId\")),Number(isLike.attr(\"status\")))\r\n}\r\n```\r\n发送请求\r\n```js\r\nfunction post_like(type,likeId,status){\r\n    $.ajax({\r\n        type: \"POST\",\r\n        url:\"/like\",\r\n        data:({\r\n            \"status\":status,\r\n            \"likeId\":likeId,\r\n            \"type\":type\r\n            }),\r\n        success:function (data){\r\n        }\r\n    });\r\n}\r\n```\r\n## 3. 后端设计\r\n### 1. 数据模型设计\r\n1. 点赞javaBean\r\n\r\n```java\r\npackage com.diao.myhub.model;\r\n\r\nimport lombok.Data;\r\n\r\n@Data\r\npublic class Great {\r\n\r\n    private Long id;\r\n\r\n    private Integer userId;\r\n\r\n\r\n    private Long likeId;\r\n\r\n    private Short type;\r\n\r\n    private Short status;\r\n\r\n    public Long getId() {\r\n        return id;\r\n    }\r\n\r\n    public void setId(Long id) {\r\n        this.id = id;\r\n    }\r\n\r\n    public Integer getUserId() {\r\n        return userId;\r\n    }\r\n\r\n    public void setUserId(Integer userId) {\r\n        this.userId = userId;\r\n    }\r\n\r\n    public Long getLikeId() {\r\n        return likeId;\r\n    }\r\n\r\n    public void setLikeId(Long likeId) {\r\n        this.likeId = likeId;\r\n    }\r\n\r\n    public Short getType() {\r\n        return type;\r\n    }\r\n    public void setType(Short type) {\r\n        this.type = type;\r\n    }\r\n\r\n    public Short getStatus() {\r\n        return status;\r\n    }\r\n\r\n    public void setStatus(Short status) {\r\n        this.status = status;\r\n    }\r\n}\r\n\r\n```\r\nGreatDTO.java\r\n```java\r\n@Data\r\npublic class GreatDTO {\r\n    private Short status;\r\n    private Long likeId;\r\n    private Short type;\r\n}\r\n```\r\n### 2. 点赞控制器\r\n```java\r\n@Controller\r\npublic class LikeController {\r\n    @Autowired\r\n    private QuestionService questionService;\r\n    @Autowired\r\n    private GreatService greatService;\r\n    @Autowired\r\n    private CommentService commentService;\r\n    @RequestMapping(value = \"/like\",method = RequestMethod.POST)\r\n    @ResponseBody\r\n    @Transactional(rollbackFor = RuntimeException.class)\r\n    public String like(@RequestBody  GreatDTO greatDTO , HttpServletRequest req){\r\n        User user = (User) req.getSession().getAttribute(\"user\");\r\n        // 如果用户不为空,记录或修改点赞对象和用户的关系\r\n        if (user!=null){\r\n            List<Great> record =  greatService.getLikeRecord(user.getId(),greatDTO.getType(),greatDTO.getLikeId());\r\n            Great great = new Great();\r\n            BeanUtils.copyProperties(greatDTO,great);\r\n            great.setUserId(user.getId());\r\n            if (record==null||record.size()==0){\r\n                greatService.createRecord(great);\r\n            }else {\r\n                // 刷新数据库记录当中的点赞状态\r\n                record.get(0).setStatus(greatDTO.getStatus());\r\n                greatService.updateRecord(record.get(0));\r\n            }\r\n            // 刷新用户表和评论表点赞记录\r\n            if (LikeTypeEnum.LIKE_TYPE_QUESTION.getType()==greatDTO.getType()){\r\n                questionService.refreshLikeCount(greatDTO.getLikeId());\r\n            }else if (LikeTypeEnum.LIKE_TYPE_COMMENT.getType()==greatDTO.getType()){\r\n                commentService.refreshLikeCount(greatDTO.getLikeId());\r\n            }\r\n        }\r\n        return \"ok\";\r\n    }\r\n}\r\n```\r\n### 3. 点赞枚举\r\n1. 点赞类型枚举\r\nLikeType.java\r\n```java\r\npublic enum LikeTypeEnum {\r\n    LIKE_TYPE_QUESTION((short) 1),\r\n    LIKE_TYPE_COMMENT((short) 2);\r\n    private short type;\r\n    LikeTypeEnum(short type) {\r\n        this.type = type;\r\n    }\r\n    public short getType() {\r\n        return type;\r\n    }\r\n}\r\n```\r\n2. 点赞状态枚举\r\nLikeStatusEnum.java\r\n```java\r\npublic enum LikeStatusEnum {\r\n    LIKE_STATUS_LIKED((short) 1),\r\n    LIKE_STATUS_UNLIKE((short) 0);\r\n\r\n    LikeStatusEnum(short status) {\r\n        this.status = status;\r\n    }\r\n\r\n    public short getStatus() {\r\n        return status;\r\n    }\r\n\r\n    private short status;\r\n}\r\n```\r\n### 4. 点赞服务层\r\n\r\n```java\r\nimport java.util.List;\r\n@Service\r\npublic  class GreatServiceImpl implements GreatService{\r\n    @Autowired\r\n    private GreatMapper greatMapper;\r\n\r\n    @Override\r\n    public LikeStatusEnum getIsLikeStatus(int userId, Long likeId, LikeTypeEnum typeEnum) {\r\n        GreatExample greatExample = new GreatExample();\r\n        greatExample.createCriteria().andUserIdEqualTo(userId).andLikeIdEqualTo(likeId).\r\n                andTypeEqualTo(typeEnum.getType());\r\n        List<Great> greats = greatMapper.selectByExample(greatExample);\r\n        if (greats==null||greats.size()==0){\r\n            return LikeStatusEnum.LIKE_STATUS_UNLIKE;\r\n        }\r\n        else {\r\n            return greats.get(0).getStatus().equals(LikeStatusEnum.LIKE_STATUS_LIKED.getStatus())?\r\n                    LikeStatusEnum.LIKE_STATUS_LIKED:LikeStatusEnum.LIKE_STATUS_UNLIKE;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    @Override\r\n    public List<Great> getLikeRecord(Integer id, Short type, Long likeId) {\r\n        GreatExample greatExample = new GreatExample();\r\n        greatExample.createCriteria().andUserIdEqualTo(id).andLikeIdEqualTo(likeId).\r\n                andTypeEqualTo(type);\r\n        return greatMapper.selectByExample(greatExample);\r\n    }\r\n\r\n    @Override\r\n    public int createRecord(Great great) {\r\n       return greatMapper.insert(great);\r\n    }\r\n\r\n    @Override\r\n    public int updateRecord(Great great) {\r\n        GreatExample greatExample = new GreatExample();\r\n        greatExample.createCriteria().andIdEqualTo(great.getId());\r\n        return   greatMapper.updateByExample(great,greatExample);\r\n    }\r\n\r\n    @Override\r\n    public long countByQuestionId(Long id) {\r\n        GreatExample greatExample = new GreatExample();\r\n        greatExample.createCriteria().andLikeIdEqualTo(id).andTypeEqualTo(LikeTypeEnum.LIKE_TYPE_QUESTION.getType()).\r\n                andStatusEqualTo(LikeStatusEnum.LIKE_STATUS_LIKED.getStatus());\r\n        return greatMapper.countByExample(greatExample);\r\n\r\n    }\r\n    @Override\r\n    public long countByCommentId(Long id) {\r\n        GreatExample greatExample = new GreatExample();\r\n        greatExample.createCriteria().andLikeIdEqualTo(id).andTypeEqualTo(LikeTypeEnum.LIKE_TYPE_COMMENT.getType()).\r\n                andStatusEqualTo(LikeStatusEnum.LIKE_STATUS_LIKED.getStatus());\r\n        return greatMapper.countByExample(greatExample);\r\n    }\r\n}\r\n```\r\n### 5. 最终效果\r\n![](http://myhub-1307157181.cos.ap-chengdu.myqcloud.com/b8d07fdc-9019-4895-b57e-810d5f8f35d0%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-08-29%20225137.png)',0,42,2,'javascript,html5,java,spring',1630174528291,1630248724601),(9,'mysql',2,'<h1 style=text-align:center>MySQL<h1>\r\n\r\n## 1. 初始数据库\r\n\r\n### 1.1什么是数据库\r\n\r\nA **database** is an organized collection of [data](https://en.wikipedia.org/wiki/Data_(computing)), generally stored and accessed electronically from a computer system.\r\n\r\n### 1.2 数据库分类\r\n\r\n#### 关系型：SQL\r\n\r\n- MySQL，Oracle，SQL Server，DB2\r\n\r\n- 通过行与列之间，表与表之间的关系进行数据储存。\r\n\r\n\r\n\r\n#### 非关系型：NoSQL(Not Only)\r\n\r\n- Redis，MongDB\r\n- 通过对象储存，由对象自身的属性决定\r\n\r\n\r\n\r\n#### DBMS：数据库管理系统\r\n\r\n- 数据库管理软件，科学有效的管理我们的数据\r\n\r\n### 1.3 MySQL简介\r\n\r\n- MySQL是目前实际上最好的关系型数据库管理软件(RDBMS)之一\r\n\r\n- 体积小，速度块，使用成本低，适合中小型网站、大型网站、集群的使用\r\n\r\n  网站：https://www.mysql.com/\r\n\r\n### 1.4 MySQL安装\r\n\r\n1. 解压安装包\r\n\r\n2. 配置环境变量 Path = xxx/bin\r\n\r\n3. 解压目录下新建配置文件my.ini\r\n\r\n4. 编辑配置文件my.ini\r\n\r\n   ```ini\r\n   [mysqld]\r\n   basedir = F:\\Environment\\mysql-5.7.34-winx64\\\r\n   datadir = F:\\Environment\\mysql-5.7.34-winx64\\data\\\r\n   port = 3306 # 选择其他端口后，进入管理界面时需要在命令后加上端口号 -P port_number\r\n   skip-grant-tables \r\n   ```\r\n\r\n5. 管理员模式运行控制台，运行命令`mysqld -install`\r\n\r\n6. 输入命令`mysqld --initialize-insecure --user=mysql`初始换数据文件\r\n\r\n7.  再次启动mysql使用命令`net start mysql`，使用命令`mysql -u root -p`进入mysql管理界面\r\n\r\n8. 执行命令`update mysql.user set authentication_string=password(\'123456\') where user = \'root\' and host = \'localhost\';`，再输入`flush privileges`;刷新权限（注意，sql语句结尾必须加分号）\r\n\r\n9. 编辑配置文件my.ini ，删除skip-grant-tables\r\n\r\n10. 重启服务,测试是否连接成功。\r\n\r\n### 1.4 安装SQLyog\r\n\r\n1. 默认安装即可\r\n\r\n2. 输入设置的数据库参数\r\n\r\n3. 新建数据库\r\n\r\n4. 建表\r\n\r\n5. 填数据\r\n\r\n6. 查看表\r\n\r\n   ........\r\n\r\n### 1.7 连接数据库\r\n\r\n1. 命令行连接\r\n\r\n   `mysql -u user -p[password] -p host -P port`\r\n\r\n2. 数据库操作\r\n\r\n   ```sql\r\n   update mysql.user set authentication_string=password(\'123456\') where user = \'root\' and host = \'localhost\'; --修改密码\r\n   flush privileges; -- 刷新权限\r\n   \r\n   use school;  -- 切换数据库 use databaseName\r\n   show tables; -- 查看数据库中所有表\r\n   describe student; -- 查看数据库所有表信息\r\n   \r\n   create database BaseName; -- 创建数据库\r\n   exit; -- 退出数据库\r\n   -- 单行注释\r\n   /*\r\n   多行注释\r\n   */\r\n   ```\r\n\r\n3. 数据库语言\r\n\r\n   DDL 	定义\r\n\r\n   DML	操作\r\n\r\n   DQL	查询\r\n\r\n   DCL	控制\r\n\r\n## 2. 操作数据库\r\n\r\n操作数据库>操作表>操作表中内容\r\n\r\n#### 2.1 操作数据库\r\n\r\nmysql不区分大小写\r\n\r\n1. 创建数据库\r\n\r\n   ```sql\r\n   CREATE DATABASE [IF NOT EXISTS] mydatabase;\r\n   ```\r\n\r\n2. 删除数据库\r\n\r\n   ```sql\r\n   DROP DATABASE [IF EXISTS] mydatabase;\r\n   ```\r\n\r\n3. 使用数据库\r\n\r\n   ```sql\r\n   USE `school`; -- 如果表名或字段名是特殊字符使用``包裹\r\n   ```\r\n\r\n4. 查看数据库\r\n\r\n   ```sql\r\n   SHOW DATABASES; -- 查看所有数据库\r\n   ```\r\n\r\n#### 2.2 数据库列的类型\r\n\r\n> 数值\r\n\r\n- 整数\r\n  - tinyint                  1byte\r\n  - samllint               2byte\r\n  - mediumint          3byte\r\n  - int                         4byte\r\n  - bigint                    8byte\r\n\r\n- 浮点数\r\n\r\n  - float					4byte\r\n\r\n  - double               8byte\r\n\r\n- 字符串浮点数\r\n  - decimal             为了解决大数的精度问题，使用字符串浮点数，一般用于金融计算\r\n\r\n> 字符串\r\n\r\n- char					字符串固定大小 0~255\r\n\r\n- varchar               可变字符串     0~65535  \r\n\r\n- tinytext                微型文本         2^8 -1\r\n\r\n- text                       文本串            2^16 -1\r\n\r\n> 时间日期\r\n\r\n- date            YYYY-MM--DD \r\n- time              HH:mm:ss\r\n- **datatime    YYYY-MM-DD HH:mm:ss**\r\n- **timestamp      时间戳**\r\n- year              年\r\n\r\n> null \r\n\r\n没有值，一般不用于计算\r\n\r\n### 2.3数据库字段属性*\r\n\r\n- unsigned\r\n  - 无符号整数\r\n  - 声明了改行不能为负数\r\n\r\n- zerofill\r\n  - 0填充\r\n  - 不足的位数，使用0来填充\r\n\r\n- 自增\r\n  - 自定在上一条记录的基础上加一\r\n  - 通常用来设计唯一的主键\r\n  - 可自定义自增的初始值和步长\r\n\r\n- 非空 not null\r\n\r\n  - 设置为not null必须设置值\r\n\r\n  - null时，不填值默认为null\r\n\r\n- 默认值 default\r\n  - 设置一列的默认值后，如果不指定实际值会使用默认值\r\n\r\n### 2.4 创建表\r\n\r\n```sql\r\nCREATE TABLE IF NOT EXISTS `students`(\r\n`id` INT(10) NOT NULL AUTO_INCREMENT COMMENT \'students id\',\r\n`name` VARCHAR(30) NOT NULL DEFAULT \'NULL\' COMMENT \'name\',\r\n`pwd` VARCHAR(20) NOT NULL DEFAULT \'12345678\' COMMENT \'password\',\r\n`sex` VARCHAR(6) NOT NULL DEFAULT \'male\' COMMENT \'gender\',\r\n`birthday` DATETIME COMMENT \'birthday\',\r\n`adddress` VARCHAR(100) DEFAULT NULL COMMENT \'address\',\r\n`email` VARCHAR(50) DEFAULT NULL COMMENT \'email\',\r\nPRIMARY KEY (`id`)\r\n \r\n)ENGINE INNODB DEFAULT CHARSET= utf8\r\n```\r\n\r\n格式\r\n\r\n```sql\r\nCREATE TABLE [IF NOT EXISTS] `tableName`(\r\n`field` vartype(varlength) [attribute][index][comment],\r\n`field` vartype(varlength) [attribute][index][comment],\r\n    .........\r\n`field` vartype(varlength) [attribute][index][comment],\r\n    \r\n [keySet]   ,\r\n    \r\n)[tableType][charset][comment]\r\n```\r\n\r\n常用命令\r\n\r\n```sql\r\nSHOW CREATE DATABASE school; -- 查看创建数据库\r\n\r\nSHOW CREATE TABLE students; -- 查看创建表\r\n\r\nDESC students; -- 查看表的结构\r\n```\r\n\r\n### 2.5 数据表的类型\r\n\r\nINNODB是现在默认使用的表\r\n\r\nMYISAM早些年使用\r\n\r\n|            | MYISAM | INNODB      |\r\n| :--------- | ------ | ----------- |\r\n| 事务支持   | 不支持 | 支持        |\r\n| 数据行锁定 | 不支持 | 支持        |\r\n| 外键约束   | 不支持 | 支持        |\r\n| 全文索引   | 支持   | 不支持      |\r\n| 占用空间   | 较小   | 较大约为2倍 |\r\n\r\n- MYISAM 节约空间，速度快\r\n- INNODB 安全性好，支持事务处理，多表多用户操作\r\n\r\n> 数据库磁盘存储位置\r\n\r\n- INNODB :data目录下的*.frm文件以及上级目录下的ibdata1文件\r\n- MYISAM：\r\n  - *.frm -表结构定义问文件\r\n  - .*MYD -索引文件\r\n  - *.MYI  - 索引问文件\r\n\r\n> 设置编码字符集\r\n\r\nMysql默认字符集不支持中文\r\n\r\n修改默认字符集\r\n\r\n- 方法1：创建表时修改\r\n\r\n    ```sql\r\n    CHARSET=utf8\r\n    ```\r\n\r\n- 方法2，在my.ini配置文件上设置默认编码\r\n\r\n  ```sql\r\n  character-set-server=utf8\r\n  ```\r\n\r\n### 2.6 修改删除数据表\r\n\r\n> 修改表\r\n\r\n```sql\r\n-- 修改表名 ALTER TABLE TableName RENAME AS NewName\r\nALTER TABLE student RENAME AS teacher;\r\n-- 增加表的字段 ALTER TABLE TableName ADD FieldName Property\r\nALTER TABLE teacher ADD age INT(3);\r\n-- 修改表字段\r\n\r\n-- 修改字段的类型约束 : ALTER TABLE TableName MODIFY FieldName NewProperty;\r\n-- \r\nALTER TABLE teacher MODIFY age VARCHAR(3);\r\n\r\n-- 修改字段名以及约束 : ALTER TABLE TableName CHANGE FieldName NewName Property;\r\nALTER TABLE teacher CHANGE vage v1age INT(3);\r\n\r\n-- MODIFY和CHANGE用来改变column的属性，change和modify执行成功后都会这本次设置的属性替换column原属性\r\n\r\n-- 删除字段:ALTER TABLE tb_name DROP FieldName;\r\nALTER TABLE teacher DROP  vlage;\r\n\r\n\r\n\r\n-- 查看表中约束\r\nSHOW KEYS FROM result;\r\n\r\n-- 添加和删除主键约束\r\nALTER TABLE result ADD PRIMARY KEY (`studentno`,subjectno);\r\nALTER TABLE result DROP PRIMARY KEY;\r\n\r\n-- 添加唯一约束\r\nALTER TABLE result UNIQUE KEY (`studentno`,subjectno);\r\n\r\n-- 删除唯一索引(约束)\r\nDROP INDEX studentno_5 ON result;\r\nALTER TABLE result DROP INDEX studentno_5;\r\n```\r\n\r\n> 删除表\r\n\r\n```sql\r\n-- DROP TABLE [IF EXISTS]  TableName;\r\nDROP TABLE IF EXISTS  teacher;\r\n```\r\n\r\n## MySQL 数据管理\r\n\r\n### 3.1 外键\r\n\r\n> 创建方式一：创建表时，创建约束\r\n\r\n```sql\r\nCREATE TABLE `students` (\r\n  `id` INT(10) NOT NULL AUTO_INCREMENT COMMENT \'students id\',\r\n  `name` VARCHAR(30) NOT NULL   COMMENT \'name\',\r\n  `pwd` VARCHAR(20) NOT NULL DEFAULT \'12345678\' COMMENT \'password\',\r\n  `sex` VARCHAR(6) NOT NULL DEFAULT \'male\' COMMENT \'gender\',\r\n  `birthday` DATETIME DEFAULT NULL COMMENT \'birthday\',\r\n  `adddress` VARCHAR(100) DEFAULT NULL COMMENT \'address\',\r\n  `email` VARCHAR(50) DEFAULT NULL COMMENT \'email\',\r\n  `score` INT(3)  NOT NULL COMMENT \'score\',\r\n  \r\n  CONSTRAINT FK_id FOREIGN KEY (id) REFERENCES grade(id),  -- 创建外键约束\r\n  -- 格式 CONSTRAINT 约束名 FOREIGN KEY (FKfield) REFERENCES RefTable(RefField)\r\n    -- [on delete cascade] [on update cascade]\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=INNODB DEFAULT CHARSET=utf8\r\n```\r\n\r\n外键一定时另一个表的主键，删除主表前，必须要删除所有从表\r\n\r\n> 创建方式二：创建表后再添加\r\n\r\n```sql\r\nALTER TABLE students\r\nADD CONSTRAINT FK_id FOREIGN KEY (id) REFERENCES grade(id);\r\n-- ALTER TABLE tableName\r\n-- ADD CONSTRAINT fk_name FOREIGN KEY (Fk_Field) REFERENCES Ref_Table(Ref_Field);\r\n```\r\n\r\n以上创建方式是物理的外键，数据库级别外键，不建议使用，可以通过程序实现外键用于维护多张表的关联。\r\n\r\n### 3.2 DML\r\n\r\nDML：数据操纵语言\r\n\r\n- insert\r\n- update\r\n- delete\r\n\r\n#### INSERT 插入\r\n\r\n```sql\r\n-- insert into tableName([feild1],[field2],....)value(val1_1,val1_2,.....),(val2_1,val2_2,.....).....\r\nINSERT INTO grade (id,score) VALUE (\'0001\',\'87\')\r\n-- 插入语句一定要保证一一对应\r\n-- 插入多个字段\r\nINSERT INTO grade (id,score) VALUES (\'00023\',\'60\'),(\'24\',\'69\'),(\'25\',\'75\');\r\n```\r\n\r\n语法：insert into tableName([feild1],[field2],....) value(val1_1,val1_2,.....),(val2_1,val2_2,.....).....\r\n\r\n注意事项：\r\n\r\n- 可以省略字段，但必须保证后面的值必须一一对应\r\n- 可以同时插入多行数据，使用 \', \'隔开\r\n\r\n#### UPDATE 修改\r\n\r\n> update  tableName set Property=\'xxx\'  where Property=\'xxx\';\r\n\r\n```sql\r\nUPDATE students SET `name`=\'liu\',sex=\'female\' WHERE id = 1;\r\n```\r\n\r\n语法：\r\n\r\n```sql\r\nUPDATE tableName SET property1=value,property2=xx WHERE [condition1] AND [condition2] AND ......;\r\n```\r\n\r\nwhere后接条件运算符\r\n\r\n-  = ,> ,<,!= 或 <>,<=,>=\r\n- between   x  and  y             [x,y]\r\n- AND  和（&&）\r\n- OR 或（||）\r\n\r\n注意：\r\n\r\n- 如果未指定修改条件，数据库将修改所有列\r\n- SET property1=value，value既可以是常量也可以是变量\r\n\r\n#### DELETE 删除\r\n\r\n> delete 命令\r\n\r\n语法: DELETE FROM TableName WHERE [condition];\r\n\r\n```sql\r\n-- 删除全部数据\r\nDELETE FROM grade;\r\n\r\n-- 删除指定数据\r\nDELETE FROM grade WHERE id = 23;\r\n```\r\n\r\n> TRUNCATE 命令\r\n\r\n完全清空一个数据表，表结构和索引约束不变\r\n\r\n```sql\r\nTRUNCATE TABLE test;\r\n```\r\n\r\n> truncate 和 delete的区别\r\n\r\ntruncate 不会影响自增，新插入数据自增重新开始\r\n\r\ndelete 后再插入数据自增会从上次自增的末尾继续自增\r\n\r\n## 4. DQL 数据查询**\r\n\r\n### 4.1 DQL\r\n\r\n?	DQL：数据查询语言\r\n\r\n> 格式\r\n\r\n```sql\r\nSELECT [ALL | DISTINCT]{* | table.*|table_field1[AS alias1],table_field2[AS alias2].....}\r\nFROM TableName [AS table_alies] [left|right|inner|natural JOIN tableName2][AS table_alies2] [ON..]\r\n[WHERE..]\r\n[GROUP BY..]\r\n[HAVING..]\r\n[ORDER BY]\r\n[LIMIT {[offset,]row_count|row_countOFFSET offset}]\r\n```\r\n\r\n\r\n> 基本查询\r\n\r\n~~~sql\r\n    -- 查询全部\r\n    SELECT * FROM student\r\n    SELECT * FROM result\r\n\r\n    -- 查询指定字段\r\n    SELECT studentno ,studentname FROM student\r\n\r\n    -- 指定字段别名 AS (表也可指定别名)\r\n    SELECT studentno AS 学号 ,studentname AS 姓名 FROM student\r\n\r\n    -- 函数 concat(a,b)拼接函数\r\n    SELECT CONCAT (\'Name:\',studentName) AS NewName FROM student\r\n    ```\r\n~~~\r\n\r\n> 查询去重 distinct\r\n\r\n作用：去除查询出来的重复数据\r\n\r\n```sql\r\n-- 去重\r\nSELECT studentno FROM result;  -- 含有重复\r\nSELECT DISTINCT studentno  FROM result;  -- 不含重复\r\n```\r\n\r\n> 表达式\r\n\r\n```sql\r\nSELECT VERSION(); -- 查版本\r\nSELECT @@auto_increment_increment; -- 查自增步长\r\nSELECT 10<<10; -- 查询计算结果\r\n\r\n-- 查询列计算结果\r\nSELECT  studentno ,studentresult +1 AS \'grade+1\' FROM result\r\n```\r\n\r\n### 4.2 Where 条件字句\r\n\r\n作用：检索数据中符合条件的值\r\n\r\n> 逻辑运算符\r\n\r\n \r\n\r\n| 运算符           | 语法                 | 描述   |\r\n| ---------------- | -------------------- | ------ |\r\n| and       &&     | a and b    a&&b      | 逻辑与 |\r\n| or          \\|\\| | a or b        a\\|\\|b | 逻辑或 |\r\n| Not        !     | not  a         !a    | 逻辑非 |\r\n\r\n```sql\r\n-- and \r\nSELECT studentno ,studentresult FROM result WHERE studentresult>=90 AND studentresult <=100;\r\n-- 模糊查询\r\nSELECT studentno ,studentresult FROM result WHERE studentresult BETWEEN 90 AND 100;\r\n\r\n-- != 等效 not\r\nSELECT studentno ,studentresult FROM result WHERE studentno != 1000;\r\nSELECT studentno ,studentresult FROM result WHERE ! (studentno = 1000);\r\n-- 等效于\r\nSELECT studentno ,studentresult FROM result WHERE studentno != 1000;\r\n```\r\n\r\n> 模糊查询：比较运算符\r\n\r\n| 运算符      | 语法                 | 描述                         |\r\n| ----------- | -------------------- | ---------------------------- |\r\n| IS NULL     | a IS NULL            | 结果为空，结果为真           |\r\n| IS NOT NULL | a IS NOT NULL        | 结果为非空，结果为真         |\r\n| BETWEEN     | a IS BETWEEN b and c | 结果b c之间为真              |\r\n| LIKE        | a LIKE b             | SQL 匹配,如果a匹配b,结果为真 |\r\n| IN          | a IN (b,c,d....)     | a属于b,c,d....其中之一为真   |\r\n\r\n```sql\r\n-- 模糊查询\r\n-- like %(0到任意个字符) _(一个字符)\r\n-- 查询姓张的同学\r\nSELECT  studentno ,studentname FROM student WHERE studentname LIKE \'张%\';\r\n-- 查询姓张的同学,名字只有两个字\r\nSELECT  studentno ,studentname FROM student WHERE studentname LIKE \'张_\';\r\n-- 查询名字中含有强的同学\r\nSELECT  studentno ,studentname FROM student WHERE studentname LIKE \'%强%\';\r\n\r\n-- in\r\n-- 查询学号为1000,1001的学生\r\nSELECT  studentno ,studentname FROM student WHERE studentno IN (1000,1001);\r\n-- 查询北京的同学\r\nSELECT  studentno ,studentname FROM student WHERE address IN (\'北京朝阳\');\r\n-- 查询生日为空的学生\r\nSELECT  studentno ,studentname FROM student WHERE borndate IS NULL;\r\n-- 查询性别不为空的同学\r\nSELECT  studentno ,studentname FROM student WHERE sex IS NOT NULL;\r\n```\r\n\r\n### 4.3 联表查询\r\n\r\n![](Join.png)\r\n\r\n> 内连接,外连接\r\n\r\n\r\n```sql\r\n-- 联表查询\r\n\r\n-- 内连接\r\n-- 条件连接及等连接\r\n-- 条件连接查询\r\nSELECT * FROM student AS s INNER JOIN result AS r WHERE r.`studentno` < s.`studentno`;\r\n-- 等连接查询\r\nSELECT * FROM student AS s INNER JOIN result AS r WHERE r.`studentno` = s.`studentno`;\r\n-- 自然连接查询,等连接查询特例,等连接的基础上保证字段名相等\r\nSELECT * FROM student AS s NATURAL JOIN result AS r ;\r\n-- 逗号连接属于本质生上就是内连接\r\nSELECT *\r\nFROM employee,department\r\nWHERE employee.DepartmentID = department.DepartmentID\r\n-- 等价于:\r\nSELECT *\r\nFROM employee\r\nINNER JOIN department\r\nON employee.DepartmentID = department.DepartmentID\r\n\r\n\r\n-- 外连接:有空值的自然连接\r\n-- 左外连接 :选取左表的全部,左表部分不满足条件则将对应字段置空\r\n-- SELECT field1,field2.... FROM table1 LEFT JOIN table2 ON [交叉条件] WHERE [筛选条件]\r\nSELECT * FROM student AS s LEFT JOIN result AS r ON s.`studentno`=r.`studentno`;\r\n\r\n-- 右外连接 \r\n-- SELECT field1,field2.... FROM table1 RIGHT JOIN table2 ON [交叉条件] WHERE [筛选条件]\r\nSELECT s.`studentname` ,s.`studentno` ,r.`studentresult`,r.`subjectno` FROM student AS s RIGHT JOIN result AS r ON s.`studentno`=r.`studentno`;\r\n\r\n-- 查询 成绩大于90的同学的学号以及科目\r\nSELECT s.`studentname` ,s.`studentno` ,r.`studentresult`,r.`subjectno` FROM student AS s RIGHT JOIN result AS r ON s.`studentno`=r.`studentno`\r\nINNER JOIN `subject` AS sub ON sub.`subjectno`=r.`subjectno`\r\nWHERE r.`studentresult`>=90;\r\n\r\n```\r\n\r\n注意:自然连接是特殊的内联结（等值联结），自然联结不能有where和on去限制筛选\r\n\r\n> 自联结\r\n\r\n 所谓自连接，指的是一个表自己和自己连接.\r\n\r\n```sql\r\nSELECT catA.`categoryname` AS \'父类\',catB.`categoryname` AS \'子类\'\r\nFROM category AS catA , category AS catB\r\nWHERE catB.`pid`=catA.`categoryid`\r\n```\r\n\r\n查询结果:区分混合在一起并且存在内部联系的一组数据\r\n\r\n![](Self.png)\r\n\r\n### 4.5 分页和排序\r\n\r\n> order by 排序 ASC 升序, DESC降序\r\n\r\n```sql\r\n-- 根据学生高数成绩升序 ORDER BY res DESC\r\nSELECT r.`studentno`,sub.`subjectname`,s.`studentname`,r.`studentresult` AS res\r\nFROM result AS r , `subject` AS sub ,student AS s\r\nWHERE sub.`subjectno`=r.`subjectno` AND r.`studentno`=s.`studentno` AND r.`subjectno`=1\r\nORDER BY res ASC\r\n```\r\n\r\n> limit \r\n\r\nLIMIT : 分页查询,将查询结果分页\r\n\r\n语法:    limit   (起始数据 , 每页数据条数)\r\n\r\n```sql\r\nSELECT r.`studentno`,sub.`subjectname`,s.`studentname`,r.`studentresult` AS res\r\nFROM result AS r , `subject` AS sub ,student AS s\r\nWHERE sub.`subjectno`=r.`subjectno` AND r.`studentno`=s.`studentno` \r\nORDER BY res ASC\r\nLIMIT 0,4\r\n\r\n-- 格式 limit (N-1)*pageSize,pageSize\r\n-- 第一页 limit 0,4\r\n-- 第二页 limit 4,4\r\n-- 第三页 limit 8,4\r\n-- 第N页 limit 4*(N-1),4\r\n```\r\n\r\n```sql\r\n-- 查询案例 查询高等数学学科大学80分前3的学生信息\r\nSELECT s.`studentno`,sub.`subjectname`,s.`studentname`,r.`studentresult`\r\nFROM student AS s \r\nINNER JOIN result AS r \r\nON  s.`studentno`=r.`studentno` \r\nINNER JOIN `subject` AS sub \r\nON r.`subjectno`= sub.`subjectno` \r\n\r\nWHERE sub.`subjectname` LIKE \'高等数学%\' AND r.`studentresult`>=\'80\'\r\nORDER BY r.`studentresult` DESC\r\nLIMIT 0,3\r\n```\r\n\r\n> where子查询\r\n\r\n子查询就是指的在一个完整的查询语句之中，嵌套若干个不同功能的小查询，从而一起完成复杂查询的一种编写形式，为了让读者更加清楚子查询的概念。\r\n\r\n**子查询可以返回的数据类型一共分为四种：**\r\n\r\n   1. 单行单列：返回的是一个具体列的内容，可以理解为一个单值数据；\r\n\r\n      ```sql\r\n      -- 查询最低的成绩\r\n      SELECT * \r\n      FROM result r\r\n      WHERE r.`studentresult`=(\r\n      SELECT MIN(r.`studentresult`)\r\n      FROM result r\r\n      );\r\n      -- 查询大于80的成绩\r\n      SELECT * \r\n      FROM result r\r\n      WHERE r.`studentresult`<(\r\n      SELECT r.`studentresult` \r\n      FROM result r\r\n      WHERE  r.`studentresult`= 80\r\n      );\r\n      -- 查询大于平均分的成绩\r\n      SELECT * \r\n      FROM result r\r\n      WHERE r.`studentresult`>(\r\n      SELECT AVG(r.`studentresult` )\r\n      FROM result r\r\n      );\r\n      ```\r\n\r\n   2. 单行多列：返回一行数据中多个列的内容；\r\n\r\n      ```sql\r\n      -- 查询和第一个学科的学时和年级相同的科目的信息\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE (classhour,gradeid)=(\r\n      SELECT classhour ,gradeid\r\n      FROM `subject`\r\n      WHERE  subjectno=1\r\n      );\r\n      ```\r\n\r\n   3. 多行单列：返回多行记录之中同一列的内容，相当于给出了一个操作范围；\r\n\r\n      主要使用三种操作符：IN、ANY、ALL\r\n\r\n      ```sql\r\n      -- IN\r\n      -- 查询课时大于等于110的全部课程信息\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE (classhour,gradeid) IN(\r\n      SELECT classhour ,gradeid\r\n      FROM `subject`\r\n      WHERE classhour >= 110\r\n      );\r\n      ```\r\n      \r\n      **ANY在使用中有如下三种使用形式：**\r\n      =ANY：表示与子查询中的每个元素进行比较，功能与IN类似（然而<>ANY不等价于NOT IN）\r\n      \\>ANY：比子查询中返回结果的最小的要大（还包含了>=ANY）\r\n      <ANY：比子查询中返回结果的最大的要小（还包含了<=ANY）\r\n      \r\n      ```sql\r\n      -- 查询学时大于120的学科\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE classhour = ANY(\r\n      SELECT classhour\r\n      FROM `subject`\r\n      WHERE classhour >= 120\r\n      );\r\n      -- 查询大于等于一年级课程中最小课时的课程\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE classhour > ANY(\r\n      SELECT classhour \r\n      FROM `subject` su\r\n      WHERE su.`gradeid` = 1\r\n      );\r\n      -- 查询小于等于二年级课程中最大课时的课程\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE classhour < ANY(\r\n      SELECT classhour \r\n      FROM `subject` su\r\n      WHERE su.`gradeid` = 2\r\n      );\r\n      ```\r\n      \r\n      **ALL操作符有以下三种用法：**\r\n      <>ALL：等价于NOT IN（但是=ALL并不等价于IN）\r\n      \\>ALL：比子查询中最大的值还要大（还包含了>=ALL）\r\n      <ALL：比子查询中最小的值还要小（还包含了<=ALL）\r\n      \r\n      ```sql\r\n      -- 查询课时不等于二年级任何课程的课时\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE classhour <> ANY(\r\n      SELECT classhour \r\n      FROM `subject` su\r\n      WHERE su.`gradeid` = 2\r\n      );\r\n      -- 查询大于等于一年级课程中最大课时的课程\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE classhour > ALL(\r\n      SELECT classhour \r\n      FROM `subject` su\r\n      WHERE su.`gradeid` = 1\r\n      );\r\n      -- 查询小于等于二年级课程中最小课时的课程\r\n      SELECT *\r\n      FROM `subject`\r\n      WHERE classhour < ALL(\r\n      SELECT classhour \r\n      FROM `subject` su\r\n      WHERE su.`gradeid` = 2\r\n      );\r\n      ```\r\n      \r\n   4. 多行多列：查询返回的结果是一张临时表；\r\n\r\n   5. 空数据判断\r\n\r\n      在SQL之中提供了一个exists结构用于判断子查询是否有数据返回。如果子查询中有数据返回，则exists结构返回true，反之返回false。\r\n\r\n      ```sql\r\n      -- 子查询返回空,EXISTS返回false,无数据输出\r\n      SELECT * \r\n      FROM `subject`\r\n      WHERE EXISTS(\r\n      SELECT * FROM `subject`\r\n      WHERE gradeid = 5	\r\n      );\r\n      -- 子查询返回有值,EXISTS返回true,返回内容\r\n      SELECT * \r\n      FROM `subject`\r\n      WHERE EXISTS(\r\n      SELECT * FROM `subject`\r\n      WHERE gradeid = 4	\r\n      );\r\n      ```\r\n\r\n      参考文章:[子查询一(WHERE中的子查询) - TonySoprano - 博客园 (cnblogs.com)](https://www.cnblogs.com/Soprano/p/10659101.html)\r\n      \r\n      \r\n\r\n### 4.7 分组\r\n\r\n> GROUP BY .... HAVING ....\r\n\r\nGROUP BY 字句的作用:对查询结果进行分组或分组统计,如对分组进行求和,求最大值,最小值,平均值和行数.\r\n\r\nGROUP BY 字句用法: 用于指定分组的列,要求select字句中除了使用聚簇函数的列外,其余各列(同一表中)都应该出现在group by 字句的列表中.\r\n\r\nHAVING字句:一般与GROUP BY字句连用,用于对分组过后的数据进行筛选\r\n\r\n```sql\r\n-- 查询 学号大于1000,成绩大于70的同学的平均成绩,学号,姓名\r\nSELECT AVG(r.`studentresult`) 平均成绩 , r.studentno 学号 ,s.`studentname` 姓名\r\nFROM result r inner JOIN student s\r\nON s.`studentno` = r.`studentno`\r\nwhere r.`studentno` > 1000\r\ngroup by r.`studentno`\r\nhaving 平均成绩 > 70\r\n```\r\n\r\n注意: WHERE 子句对FROM字句的结果设置过滤条件,而HAVING字句对GROUP BY字句结果进行进行再次过滤.\r\n\r\n## 5 .SQL函数\r\n\r\n### 5.1常用函数\r\n\r\n[MySQL :: MySQL 5.7 Reference Manual :: 12.1 SQL Function and Operator Reference](https://dev.mysql.com/doc/refman/5.7/en/sql-function-reference.html)\r\n\r\n```sql\r\n-- 数学运算\r\nSELECT ABS(-8) -- 绝对值\r\nSELECT CEILING(2.2) -- 向上取整\r\nSELECT FLOOR(3.7) -- 向下取整\r\nSELECT RAND() -- 返回一个0~1的随机数\r\nSELECT SIGN(10) --  判断一个数的符号,0返回0,负数返回-1,正数返回1\r\n\r\n-- 字符串函数\r\nSELECT CHAR_LENGTH (\'草泥马,小逼崽子真没见过黑\r\n社会啊,让你见识见识什么叫黑手!!\') ; -- 字符串长度\r\nSELECT CONCAT(\'我\',\'爱\',\'你\',\'!\');  -- 字符串拼接\r\nSELECT INSERT(\'hello motherfuker!\',1,5,\'hi\'); -- 字符串插入 (\'str\',pos,len,\'newStr\')\r\nSELECT LOWER(\'FuckK\'); -- 小写\r\nSELECT UPPER(\'FuckK\'); -- 大写\r\nSELECT INSTR(\'fuck\',\'c\') -- 返回第一次出现字串的索引\r\nSELECT REPLACE(\'坚持与努力\',\'与\',\'&\'); -- 替换 (\'str\',\'subStr\',\'newStr\')\r\nSELECT SUBSTR(\'hello you\',7,1); -- 取字串 (\'str\',pos,len)\r\nSELECT REVERSE(\'iiiiiamY\'); -- 反转\r\n\r\n-- 查询替换\r\nSELECT REPLACE(s.`studentname`,\'王\',\'刘\')\r\nFROM student s\r\n\r\n\r\n-- 时间和日期\r\n\r\nSELECT CURRENT_DATE(); -- 当前日期\r\nSELECT CURDATE(); -- 当前日期\r\nSELECT NOW(); --  现在时间和日期\r\nSELECT LOCALTIME(); -- 本地时间和日期\r\nSELECT SYSDATE(); -- 系统时间和日期\r\n\r\n-- 获取一个时间和日期的部分\r\nSELECT YEAR(NOW());\r\nSELECT MONTH(NOW());\r\nSELECT DAY(NOW());\r\nSELECT MINUTE(NOW());\r\nSELECT SECOND(NOW());\r\n\r\n\r\n-- 系统\r\nSELECT SYSTEM_USER();\r\nSELECT USER();\r\nSELECT VERSION();\r\n```\r\n\r\n### 5.2 聚合函数\r\n\r\n```sql\r\n--  聚簇函数\r\nSELECT COUNT(gradeid) FROM student;  -- 统计指定列的行数,忽略NULL\r\nSELECT COUNT(1) FROM student; -- 1相当于行数,查询行数,不会忽略null\r\nSELECT COUNT(*) FROM student; -- 查询所有列,相当于行数,不会忽略NULL\r\n\r\nSELECT SUM(studentresult) FROM result; -- 列求和\r\nSELECT AVG(studentresult) FROM result; -- 求均值\r\nSELECT MIN(studentresult) FROM result; -- 最小值\r\nSELECT MAX(studentresult) FROM result; -- 最大值\r\n```\r\n\r\n### 5.3 数据库级别的MD5加密\r\n\r\n```sql\r\n-- MD5加密\r\n-- 直接对表中数据加密\r\nUPDATE test SET pwd = MD5(pwd);\r\n-- 插入是加密\r\nINSERT 	INTO test VALUE(\'0129\',MD5(\'123222\'));\r\n-- 对加密后的密码进行校验\r\nSELECT * FROM test WHERE id = \'0129\' AND pwd = MD5(123222);\r\n```\r\n\r\n## 6. 事务\r\n\r\n事务具有4个特征，分别是原子性、一致性、隔离性和持久性，简称事务的ACID特性；\r\n\r\n**1.原子性（atomicity)**\r\n\r\n一个事务要么全部提交成功，要么全部失败回滚，不能只执行其中的一部分操作，这就是事务的原子性.\r\n\r\n**2.一致性（consistency)**\r\n\r\n事务的执行不能破坏数据库数据的完整性和一致性，一个事务在执行之前和执行之后，数据库都必须处于一致性状态。\r\n\r\n如果数据库系统在运行过程中发生故障，有些事务尚未完成就被迫中断，这些未完成的事务对数据库所作的修改有一部分已写入物理数据库，这是数据库就处于一种不正确的状态，也就是不一致的状态.\r\n\r\n**3.隔离性（isolation）**\r\n\r\n事务的隔离性是指在并发环境中，并发的事务时相互隔离的，一个事务的执行不能不被其他事务干扰。不同的事务并发操作相同的数据时，每个事务都有各自完成的数据空间，即一个事务内部的操作及使用的数据对其他并发事务时隔离的，并发执行的各个事务之间不能相互干扰。\r\n\r\n**4. 持久性（durability）**\r\n\r\n一旦事务提交，那么它对数据库中的对应数据的状态的变更就会永久保存到数据库中。--即使发生系统崩溃或机器宕机等故障，只要数据库能够重新启动，那么一定能够将其恢复到事务成功结束的状态\r\n\r\n> 4个事务隔离级别\r\n\r\n在标准SQL规范中，定义了4个事务隔离级别，不同的隔离级别对事务的处理不同，分别是：未授权读取，授权读取，可重复读取和串行化\r\n\r\n1、读未提交（Read Uncommited），该隔离级别允许脏读取，其隔离级别最低；比如事务A和事务B同时进行，事务A在整个执行阶段，会将某数据的值从1开始一直加到10，然后进行事务提交，此时，事务B能够看到这个数据项在事务A操作过程中的所有中间值（如1变成2，2变成3等），而对这一系列的中间值的读取就是未授权读取\r\n\r\n2、授权读取也称为已提交读（Read Commited），授权读取只允许获取已经提交的数据。比如事务A和事务B同时进行，事务A进行+1操作，此时，事务B无法看到这个数据项在事务A操作过程中的所有中间值，只能看到最终的10。另外，如果说有一个事务C，和事务A进行非常类似的操作，只是事务C是将数据项从10加到20，此时事务B也同样可以读取到20，即授权读取允许不可重复读取。\r\n\r\n3、可重复读（Repeatable Read)\r\n\r\n就是保证在事务处理过程中，多次读取同一个数据时，其值都和事务开始时刻是一致的，因此该事务级别禁止不可重复读取和脏读取，但是有可能出现幻影数据。所谓幻影数据，就是指同样的事务操作，在前后两个时间段内执行对同一个数据项的读取，可能出现不一致的结果。在上面的例子中，可重复读取隔离级别能够保证事务B在第一次事务操作过程中，始终对数据项读取到1，但是在下一次事务操作中，即使事务B（注意，事务名字虽然相同，但是指的是另一个事务操作）采用同样的查询方式，就可能读取到10或20；\r\n\r\n4、串行化\r\n\r\n是最严格的事务隔离级别，它要求所有事务被串行执行，即事务只能一个接一个的进行处理，不能并发执行。\r\n\r\n\r\n参考文章:[ACID - 简书 (jianshu.com)](https://www.jianshu.com/p/fc8a654f2205)\r\n\r\n\r\n\r\n\r\n> 隔离性导致的一些问题\r\n\r\n**脏读**:\r\n\r\n指的是一个事务读取到另一个事务为提交的数据\r\n\r\n**不可重复读:**\r\n\r\n一个事务前后读取某行数据的结果不一致\r\n\r\n**虚度(幻读)**:\r\n\r\n一个事务读取到另外一个事新插入的数据\r\n\r\n> MySQL事务常用操作\r\n\r\n ```sql\r\n -- mysql 默认开启事务的自动提交\r\n \r\n SET autocommit = 0; -- 关闭事务自动提交\r\n SET autocommit = 1; -- 开启事务自动提交\r\n \r\n START TRANSACTION -- 标记事务的开始\r\n \r\n COMMIT -- 提交事务成功,持久化\r\n ROLLBACK -- 回滚事务\r\n \r\n SET autocommit = 1\r\n \r\n SAVEPOINT -- 设置一个保存点\r\n ROLLBACK SAVEPOINT --  回滚到保存点\r\n RELEASE SAVEPOINT -- 撤销保存点\r\n ```\r\n\r\n> 模拟转账\r\n\r\n```sql\r\n-- 转账\r\n\r\nCREATE DATABASE shop CHARACTER SET utf8 COLLATE utf8_general_ci;\r\nUSE shop;\r\nCREATE TABLE account(\r\nid INT(4) ZEROFILL NOT NULL AUTO_INCREMENT PRIMARY KEY,\r\n`name` VARCHAR(50) NOT NULL,\r\nmoney DECIMAL(9,2) NOT NULL\r\n)CHARSET=utf8;\r\n\r\nINSERT INTO account(`name`,`money`) VALUES(\'A\',\'2000.00\'),(\'B\',\'1000.00\');\r\nCOMMIT;\r\n\r\n-- 模拟事务转账\r\nSET autocommit = 0; -- 关闭事务自动提交\r\n\r\nSTART TRANSACTION -- 开启事务的执行\r\n\r\nUPDATE account SET money = money - 1000 WHERE `name` = \'A\';  -- 执行事务\r\nUPDATE account SET money = money + 1000 WHERE `name` = \'B\';\r\n\r\nCOMMIT -- 提交事务成功,持久化\r\nROLLBACK -- 回滚事务\r\n\r\nSET  autocommit = 1; -- 恢复事务自动提交\r\n```\r\n\r\n## 7. 索引的分类\r\n\r\nMySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。\r\n\r\n### 7.1 索引的分类\r\n\r\n- 主键索引(PRIMARY KEY)\r\n\r\n  它是一种特殊的唯一索引，不允许有空值。一个表只能有一个主键。\r\n\r\n- 唯一索引(UNIQUE KEY)\r\n\r\n  它与前面的普通索引类似，不同的就是：普通索引允许被索引的数据列包含重复的值。而唯一索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。\r\n\r\n- 常规索引(KEY/INDEX)\r\n\r\n  这是最基本的索引，它没有任何限制。普通索引（由关键字KEY或INDEX定义的索引）的唯一任务是加快对数据的访问速度。因此，应该只为那些最经常出现在查询条件(WHERE column = …)或排序条件(ORDER BY column)中的数据列创建索引。\r\n\r\n- 全文索引(FULLTEXT)\r\n\r\n  全文索引时将存储在数据库中的整本书或整篇文章中的任意内容信息查找出来的技术。它可以根据需要获取全文中有关章，节，段，句，词等信息，也可以进行各种统计和分析。\r\n\r\n参考:[MySQL索引总结 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/29118331)\r\n\r\n> 索引的基本操作\r\n\r\n```sql\r\n-- 显示索引信息\r\nSHOW index from `subject`;\r\n\r\n-- 创建索引 \r\n\r\n-- 方法1:创建表时指定\r\nUNIQue KEY -- 列创建时,加上索引\r\nUNIQue key [`indexName`] (`Field`)\r\n\r\n-- 方法2: CREATE IndexType indexName ON Table|View(Field[ASC|DESC])\r\nCREATE fulltext INDEX nameIndex ON `subject`(subjectname) ;\r\n\r\n-- 删除索引\r\ndrop index nameindex on `subject`\r\n\r\n-- 分析sql执行状况explain\r\nexplain select subjectno from `subject`\r\n```\r\n\r\n### 7.2 测试索引\r\n\r\n```sql\r\ncreate table `app_user`(\r\n`id` BIGINT(20) UNSIGNED NOT NULL ,\r\n`name` VARCHAR(50) DEFAULT \'\',\r\n`eamil` VARCHAR(50) default NOT NULL,\r\n`phone` VARCHAR(20) DEFAULT \'\',\r\n`gender` TINYINT(4) UNSIGNED DEFAULT 0,\r\n`password` VARCHAR(100) NOT NULL DEFAULT \'0\',\r\n`age` TINYINT(4) DEFAULT \'0\',\r\n`create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n`update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\r\nPRIMARY KEY (`id`)\r\n) ENGINE=INNODB DEFAULT CHARSET=utf8\r\n\r\nalter table `app_user` change `eamil` email ;\r\nalter table `app_user` modify id BIGINT(20) UNSIGNED NOT NULL;\r\n\r\n-- 插入100万数据\r\ndelimiter $$ -- 写函数之前的标志\r\ncreate function mock_data1() \r\nreturns INT\r\nbegin\r\ndeclare num int default 1000000;\r\ndeclare i int default 1;\r\nwhile i < num Do\r\n	INSERT INTO app_user(`id`,`name`,`phone`) VALUEs(i,concat(\'用户\',i),i+10000);\r\n	SET i = i+1;\r\nend while;\r\nreturn i;\r\nend;	\r\n\r\nTRUNCATE TABLE app_user; -- 清除数据\r\n\r\nselect mock_data1();\r\n\r\ninsert into app_user(`id`)value(1);\r\n\r\n\r\n-- 测试索引\r\n\r\n-- 无索引\r\nselect * from app_user where `name` = \'用户889977\'; -- 0.451 sec\r\n\r\n-- 创建索引\r\ncreate unique index nameIndex on app_user(`name`); \r\n\r\n-- 有索引\r\nSELECT * FROM app_user WHERE `name` = \'用户889977\'; -- 0.001 sec\r\n\r\nexplain SELECT * FROM app_user WHERE `name` = \'用户889977\'; -- 0.001 sec\r\n\r\n-- 删除索引 \r\ndrop index nameindex on app_user;\r\n```\r\n\r\n### 7.3 索引原则\r\n\r\n- 索引不是越多越好\r\n- 不需要对经常变动的数据加索引\r\n- 小数据量不需要索引\r\n- 索引一般加在常用来查询的字段上\r\n\r\n> 索引的数据结构\r\n\r\nHash类型\r\n\r\nB-Tree\r\n\r\n[一文搞懂MySQL索引（清晰明了）_我本可以-CSDN博客_mysql索引](https://blog.csdn.net/wangfeijiu/article/details/113409719)\r\n\r\n## 8. 权限管理和备份\r\n\r\n### 8.1 权限管理\r\n\r\n1. 图像化\r\n\r\n![image-20210428000430700](Accessibility.png)\r\n\r\n2. sql命令\r\n\r\n   ```sql\r\n   -- 创建用户\r\n   CREATE  USER wang IDENTIFIED BY \'1\';\r\n   \r\n   -- 修改密码 (当前用户)\r\n   SET PASSWORD = PASSWORD(\'1\');\r\n   \r\n   -- 修改密码 (指定用户)\r\n   SET PASSWORD FOR wang = PASSWORD(\'0\');\r\n   \r\n   -- 重命名\r\n   RENAME USER wang TO wang1;\r\n   \r\n   --  用户授权\r\n   GRANT ALL PRIVILEGES ON *.* TO  wang1;\r\n   \r\n   -- 权限查询\r\n   SHOW GRANTS FOR wang1; -- 查看指定用户的权限\r\n   SHOW GRANTS FOR root@localhost ; -- 查看root用户权限\r\n   \r\n   -- 撤销权限 REVOKE Privileges ON Database FROM user\r\n   \r\n   REVOKE ALL PRIVILEGES ON *.* FROM wang1;\r\n   \r\n   -- 删除用户\r\n   DROP USER wang1;\r\n   ```\r\n\r\n### 8.2 数据库备份\r\n\r\n1. 可视化导入导出\r\n\r\n2. 命令行(速度快)\r\n\r\n   ```bash\r\n   mysqldump -u User -p[Password] [-h Host] [-P port] database [table1] [table2].... >FileOut\r\n   ```\r\n\r\n   ```shell\r\n   # 导出\r\n   mysqldump -u root -p123456 school1 student>D:/test1.sql # 导出school1数据库student表\r\n   mysqldump -u root -p123456 school1 subject student>D:/test2.sql # 导出school1和subject数据库student表\r\n   mysqldump -u root -p123456 school1 >D:/test3.sql # 导出school1数据库\r\n   # 导入\r\n   # 方法1:\r\n   # mysql -u user -p[password] [-p host] [-P port] 进入登录状态\r\n   # 切换到指定数据库\r\n   # source 备份文件\r\n   mysql> source d:/testb.sql\r\n   # 方法2\r\n   # 直接导入 mysql -p -u user [-P port][-h host] database < backup_File\r\n   mysql -p -u Admin test < d:/test11.sql\r\n   ```\r\n\r\n   \r\n\r\n## 9. 数据库设计范式\r\n\r\n#### 软件开发中的数据库设计\r\n\r\n- 用户需求分析\r\n- 数据库概念模式设计 E-R关系图\r\n\r\n[数据库设计规范 - swarb - 博客园 (cnblogs.com)](https://www.cnblogs.com/swarb/p/9924258.html)\r\n\r\n#### 数据库设计3大范式\r\n\r\n出现原因：\r\n\r\n关系模式中存在如下异常，需要通过逐步规范化来消除异常：\r\n\r\n- 插入异常\r\n- 删除异常\r\n- 冗余\r\n- 更新异常\r\n\r\n**第一范式（1NF）**\r\n\r\n满足原子性：保证每列不可分\r\n\r\n**第二范式（2NF）**\r\n\r\n满足第一范式，第二范式需要确保数据库表中的每一列都和主键相关，而不能只与主键的某一部分相关（主要针对联合主键而言）即一张表只能描述一件事。\r\n\r\n**第三范式（3NF）**\r\n\r\n满足一二范式，每张表每个字段都和主键直接相关，而不能间接相关。\r\n\r\n参考：[如何理解关系型数据库的常见设计范式？ - 知乎 (zhihu.com)](https://www.zhihu.com/question/24696366)\r\n\r\n## 10. JDBC\r\n\r\n### 10.1JDBC概述              \r\n\r\n- JDBC（Java Data Base Connectivity,java数据库连接）是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，它由一组用Java语言编写的类和接口组成。是Java访问数据库的标准规范          \r\n-  JDBC提供了一种基准,据此可以构建更高级的工具和接口，使数据库开发人员能够编写数据库应用程序。        \r\n- JDBC需要连接驱动，驱动是两个设备要进行通信，满足一定通信数据格式，数据格式由设备提供商规定设备提供商为设备提供驱动软件，通过软件可以与该设备进行通信。         \r\n-  我们使用的是mysql 的驱动 mysql-connector-java-5.1.39-bin.jar\r\n\r\n![](JDBC.jpg)\r\n\r\n### 10.2 JDBC程序\r\n\r\n```Java\r\nimport java.sql.*;\r\n\r\npublic class FirstJDBCDemo {\r\n    public static void main(String[] args) throws ClassNotFoundException, SQLException {\r\n        // 1. 加载驱动\r\n        Class.forName(\"com.mysql.jdbc.Driver\"); // 加载驱动的固定写法\r\n        // 2. 用户信息和url\r\n        String url = \"jdbc:mysql://localhost:3306/school1?useUnicode=true&characterEncoding=utf8&useSSL=false\";\r\n        String username = \"root\";\r\n        String password = \"123456\";\r\n        // 3. 连接数据库 connection代表数据库\r\n        Connection connection = DriverManager.getConnection(url, username, password);\r\n        // 4. 执行sql对象\r\n        Statement statement = connection.createStatement();\r\n        String sql = \"select * from result\";\r\n        ResultSet resultSet = statement.executeQuery(sql); // 返回查询的结果集\r\n\r\n        while(resultSet.next()){  // 获取查询结果\r\n            System.out.println(\"学号：\"+resultSet.getObject(\"studentNo\"));\r\n            System.out.println(\"科目：\"+resultSet.getObject(\"subjectNo\"));\r\n            System.out.println(\"成绩：\"+resultSet.getObject(\"studentResult\"));\r\n            System.out.println(\"===========================\");\r\n        }\r\n        // 5. 释放连接\r\n        resultSet.close();\r\n        statement.close();\r\n        connection.close();\r\n    }\r\n}\r\n```\r\n\r\n> DriverManager\r\n\r\n```java\r\nClass.forName(\"com.mysql.jdbc.Driver\"); // 加载驱动的固定写法\r\n\r\n// DriverManager.registerDriver(new com.mysql.jdbc.Driver);\r\n```\r\n\r\n Class.forName(xxx.xx.xx)的作用是要求JVM查找并加载指定的类，也就是说JVM会执行该类的静态代码段,此处加载DriverManager.registerDriver(new Driver());\r\n\r\n而在JDBC规范中明确要求这个Driver类必须向DriverManager注册自己，即任何一个JDBC Driver的 Driver类的代码都必须类似如下：\r\n\r\n```java\r\npublic class MyJDBCDriver implements Driver {\r\nstatic {\r\nDriverManager.registerDriver(new MyJDBCDriver());\r\n}\r\n}\r\n```\r\n\r\n参考：[Class.forName()用法详解_Kaiwii的专栏-CSDN博客_classforname用法](https://blog.csdn.net/Kaiwii/article/details/7405761?utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromMachineLearnPai2~default-1.control)\r\n\r\n> Connection \r\n\r\n```java\r\n// 3. getConnection(url,userName,password)方法获取数据库 connection代表获取到的数据库对象\r\nConnection connection = DriverManager.getConnection(url, username, password);\r\n// collection对象可用于执行事务\r\ncollection.rollback();  // 回滚\r\ncollection.commit();	// 提交\r\ncollection.setAutoCommit(); //  设置自动提交\r\n```\r\n\r\n> Url\r\n\r\n```java\r\nString url = \"jdbc:mysql://localhost:3306/school1?useUnicode=true&characterEncoding=utf8&useSSL=false\";\r\n// jdbc:mysql://Host:Port/Database?param1&parm2......\r\n```\r\n\r\n> Statement 执行SQL对象\r\n\r\nStatement 和 Prestatement都可用于执行SQL对象当你需要执行Statement对象**多次**的时候，PreparedStatement对象将会**大大降低运行时间**，当然也加快了访问数据库的速度 -- [Java数据库JDBC――prepareStatement的用法和解释_nnzhuilian的博客-CSDN博客_preparestatement](https://blog.csdn.net/nnzhuilian/article/details/86241787)\r\n\r\n```java\r\nstatement.executeQuery();// 执行查询 返回一个结果集合\r\nstatement.excute();      // 执行sql语句\r\nstatement.excuteUpdate();// 执行修改（删除，更新，插入）    \r\n```\r\n\r\n> ResultSet\r\n\r\n```java\r\nResultSet resultSet = statement.executeQuery(sql); // 返回查询的结果集\r\n```\r\n\r\nresultSet 执行查询返回的结果集\r\n\r\n```java\r\nresultSet.getObject(\"field\"); // 获取类型未知类型的列\r\n// 获取已知类型\r\nresultSet.getString(\"field\");\r\nresultSet.getInt(\"field\");\r\nresultSet.getDate(\"field\");\r\n..... \r\n```\r\n\r\n指针查找结果集合\r\n\r\n```java\r\nresultSet.beforeFirst(); // 指针移动到头部\r\nresultSet.afterLast();   // 指针移动到尾部\r\nresultSet.next();        // 指针移动到下一个数据\r\nresultSet.previous();    // 指针向前移动\r\nresultSet.absolute(int row); // 指针移动到指定行\r\n```\r\n\r\n> 释放资源\r\n\r\n```java\r\nresultSet.close();\r\nstatement.close();\r\nconnection.close();\r\n```\r\n\r\n### 10.3 Statement\r\n\r\n当你创建了一个 Statement 对象之后，你可以用它的三个执行方法的任一方法来执行 SQL 语句。\r\n\r\n**boolean execute(String SQL) :**如果 ResultSet 对象可以被检索，则返回的布尔值为 true ，否则返回 false 。当你需要使用真正的动态 SQL 时，可以使用这个方法来执行 SQL DDL 语句。\r\n\r\n**int executeUpdate(String SQL) :**返回执行 SQL 语句影响的行的数目。使用该方法来执行 SQL 语句，是希望得到一些受影响的行的数目，例如，INSERT，UPDATE 或 DELETE 语句。\r\n\r\n**ResultSet executeQuery(String SQL) :**返回一个 ResultSet 对象。当你希望得到一个结果集时使用该方法，就像你使用一个 SELECT 语句。\r\n\r\n> 简化查询\r\n\r\n- 创建查询工具类用于简化查询\r\n\r\n  数据库信息文件\r\n\r\n  db.properties\r\n\r\n  ```bash\r\n  # 数据库配置信息\r\n  driver=com.mysql.jdbc.Driver\r\n  url = jdbc:mysql://localhost:3306/school1?useUnicode=true&characterEncoding=utf8&useSSL=false\r\n  userName = root\r\n  passWord = 123456\r\n  ```\r\n\r\n  数据库配置工具类\r\n\r\n  ```Java\r\n  import java.io.IOException;\r\n  import java.io.InputStream;\r\n  import java.sql.*;\r\n  import java.util.Properties;\r\n  \r\n  // 简化数据库配置工具类\r\n  public class JdbcUtils {\r\n      private static String driver = null;\r\n      private static String url = null;\r\n      private static String passWord = null;\r\n      private static String userName = null;\r\n  \r\n      static {\r\n           // 加载数据库配置\r\n          InputStream in = JdbcUtils.class.getClassLoader().getResourceAsStream(\"db.properties\");\r\n          Properties properties = new Properties();\r\n          try {\r\n              properties.load(in);\r\n              driver = properties.getProperty(\"driver\");\r\n              url = properties.getProperty(\"url\");\r\n              passWord = properties.getProperty(\"passWord\");\r\n              userName = properties.getProperty(\"userName\");\r\n              // 加载数据库驱动\r\n              Class.forName(\"com.mysql.jdbc.Driver\");\r\n          } catch (IOException e) {\r\n              e.printStackTrace();\r\n          } catch (ClassNotFoundException e) {\r\n              e.printStackTrace();\r\n          }\r\n      }\r\n      // 连接数据库\r\n      public static Connection connectBD() throws SQLException {\r\n          Connection connection = DriverManager.getConnection(url, userName, passWord);\r\n          return connection;\r\n      }\r\n  \r\n      // 释放资源\r\n      public static void releaseBD(Connection connection, Statement statement, ResultSet resultSet) throws SQLException {\r\n          if (connection!=null)\r\n              connection.close();\r\n          if (statement!=null)\r\n              statement.close();\r\n          if (resultSet!=null)\r\n              resultSet.close();\r\n      }\r\n  }\r\n  ```\r\n\r\n  \r\n\r\n> executeUpdate\r\n\r\n```java\r\npackage JDBC.demo02;\r\n\r\nimport JDBC.demo02.utils.JdbcUtils;\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport java.sql.Statement;\r\n\r\npublic class TestDB {\r\n    public static void main(String[] args) {\r\n        ResultSet rs = null;\r\n        Connection connection = null;\r\n        Statement upStatement = null;\r\n        try {\r\n            // 连接数据库\r\n            connection = JdbcUtils.connectBD();\r\n            // 创建sql声明\r\n            upStatement = connection.createStatement();\r\n            // 插入sql\r\n            String testInsetSql = \"INSERT INTO result VALUES(1002,\'1\',\'2013-11-11 16:00:00\',70), \" +\r\n                    \"(1003,1,\'2013-11-11 16:00:00\',82)\";\r\n            // 删除sql\r\n            String testDeleteSql = \"DELETE FROM result  WHERE studentno = 1002 AND subjectno = 1\";\r\n            // 修改sql\r\n            String testUpdateSql = \"UPDATE result SET studentresult = 90 WHERE studentno = 1001 AND subjectno = 1\";\r\n\r\n            if (upStatement.executeUpdate(testUpdateSql) > 0)\r\n                System.out.println(\"更新成功！\");\r\n            else\r\n                System.out.println(\"跟新失败！\");\r\n        } catch (SQLException throwables) {\r\n            throwables.printStackTrace();\r\n        }\r\n        finally {\r\n            try {\r\n                // 关闭连接\r\n                JdbcUtils.releaseBD(connection,upStatement,rs);\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n> executeQuery\r\n\r\n```java\r\npackage JDBC.demo02;\r\n\r\nimport JDBC.demo02.utils.JdbcUtils;\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport java.sql.Statement;\r\n\r\npublic class TestDBQuery {\r\n    public static void main(String[] args) {\r\n        ResultSet rs = null;\r\n        Connection connection = null;\r\n        Statement quStatement = null;\r\n        try {\r\n            // 连接数据库\r\n            connection = JdbcUtils.connectBD();\r\n            // 创建sql声明\r\n            quStatement = connection.createStatement();\r\n            // 查询sql语句\r\n            String testQuerySql = \"select * from result\";\r\n            rs = quStatement.executeQuery(testQuerySql);\r\n            while (rs.next()){\r\n                System.out.println(rs.getObject(\"studentno\"));\r\n                System.out.println(rs.getObject(\"subjectno\"));\r\n                System.out.println(rs.getObject(\"examdate\"));\r\n                System.out.println(rs.getObject(\"studentresult\"));\r\n            }\r\n        } catch (SQLException throwables) {\r\n            throwables.printStackTrace();\r\n        }\r\n        finally {\r\n            try {\r\n                // 关闭连接\r\n                JdbcUtils.releaseBD(connection,quStatement,rs);\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n> SQL 注入\r\n\r\nSQL注入攻击指的是通过构建特殊的输入作为参数传入Web应用程序，而这些输入大都是SQL语法里的一些组合，通过执行SQL语句进而执行攻击者所要的操作，其主要原因是程序没有细致地过滤用户输入的数据，致使非法数据侵入系统。\r\n\r\nsql注入实例\r\n\r\n```java\r\nimport JDBC.demo02.utils.JdbcUtils;\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport java.sql.Statement;\r\n\r\npublic class TestSQLInjection {\r\n    public static void main(String[] args) {\r\n        // 无论账号密码填什么都能登录成功\r\n        login(\" addcad \'or \'1=1\",\"dascdd \'or\' 1=1\");\r\n    }\r\n    public static void login(String usrN ,String pwd){\r\n        ResultSet rs = null;\r\n        Connection connection = null;\r\n        Statement quStatement = null;\r\n        try {\r\n            // 连接数据库\r\n            connection = JdbcUtils.connectBD();\r\n            // 创建sql声明\r\n            quStatement = connection.createStatement();\r\n            // 查询sql语句\r\n            String testQuerySql = \"select * from `user` where `user_id` = \'\"+usrN+\"\'AND `pwd` = \'\"+pwd+\"\'\";\r\n            rs = quStatement.executeQuery(testQuerySql);\r\n            if (rs.next()){\r\n                System.out.println(\"登录成功！\");\r\n            }\r\n            else\r\n                System.out.println(\"账号或密码错误！\");\r\n\r\n        } catch (SQLException throwables) {\r\n            throwables.printStackTrace();\r\n        }\r\n        finally {\r\n            try {\r\n                // 关闭连接\r\n                JdbcUtils.releaseBD(connection,quStatement,rs);\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n扩展：\r\n\r\nsql注入：[三种数据库的 SQL 注入详解_YT的博客-CSDN博客_sql注入](https://blog.csdn.net/weixin_43915762/article/details/87909751)\r\n\r\nsql注入防御：[SQL注入详解 - myseries - 博客园 (cnblogs.com)](https://www.cnblogs.com/myseries/p/10821372.html)\r\n\r\n### 10.4 PreparedStatement\r\n\r\n> 更新（删，改，增）\r\n\r\n```Java\r\nimport JDBC.demo02.utils.JdbcUtils;\r\n\r\nimport java.sql.*;\r\nimport java.util.Date;\r\n\r\npublic class TestPreStatement {\r\n    public static void main(String[] args) {\r\n        ResultSet rs = null;\r\n        Connection connection = null;\r\n        PreparedStatement pst1 = null;\r\n        PreparedStatement pst2 = null;\r\n        PreparedStatement pst3 = null;\r\n        try {\r\n            // 连接数据库\r\n            connection = JdbcUtils.connectBD();\r\n\r\n            // 插入sql\r\n            String testInsetSql = \"INSERT INTO result VALUES(?,?,?,?)\"; // 使用预编译是sql语句中参数使用占位符?\r\n            // 删除sql\r\n            String testDeleteSql = \"DELETE FROM result  WHERE studentno = ? AND subjectno = ?\";\r\n            // 修改sql\r\n            String testUpdateSql = \"UPDATE result SET studentresult = ? WHERE studentno = ? AND subjectno = ?\";\r\n\r\n            pst1 = connection.prepareStatement(testInsetSql); // 预编译sql\r\n\r\n            pst1.setInt(1,1005); // 给参数赋值\r\n            pst1.setInt(2,1);\r\n            pst1.setDate(3, new java.sql.Date(new Date().getTime()));\r\n            pst1.setInt(4,89);\r\n\r\n            if (pst1.executeUpdate()>0)\r\n                System.out.println(\"插入成功！\");\r\n            else System.out.println(\"插入失败\");\r\n\r\n            pst2 = connection.prepareStatement(testDeleteSql);\r\n            pst2.setInt(1,1003);\r\n            pst2.setInt(2,1);\r\n            if (pst2.executeUpdate()>0){\r\n                System.out.println(\"删除成功\");\r\n            }\r\n            else System.out.println(\"删除失败\");\r\n\r\n            pst3 = connection.prepareStatement(testUpdateSql);\r\n            pst3.setInt(1,80);\r\n            pst3.setInt(2,1000);\r\n            pst3.setInt(3,2);\r\n            if (pst3.executeUpdate()>0){\r\n                System.out.println(\"修改成功\");\r\n            }\r\n            else System.out.println(\"修改失败\");\r\n\r\n\r\n        } catch (SQLException throwables) {\r\n            throwables.printStackTrace();\r\n        }\r\n        finally {\r\n            try {\r\n                // 关闭连接\r\n                JdbcUtils.releaseBD(connection, null,pst1,pst2,pst3);\r\n\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n> 查询\r\n\r\n```Java\r\nimport JDBC.demo02.utils.JdbcUtils;\r\n\r\nimport java.sql.*;\r\n\r\npublic class TestPreStaQuery {\r\n    public static void main(String[] args) {\r\n        ResultSet rs = null;\r\n        Connection connection = null;\r\n        PreparedStatement pst = null;\r\n        try {\r\n            // 连接数据库\r\n            connection = JdbcUtils.connectBD();\r\n            // 查询sql语句\r\n            String testQuerySql = \"select subjectno,studentresult from result where studentno = ?\";\r\n            pst = connection.prepareStatement(testQuerySql);\r\n\r\n            pst.setInt(1,1001);\r\n\r\n            rs = pst.executeQuery();\r\n\r\n            while (rs.next()){\r\n                System.out.print(rs.getObject(\"subjectno\")+\"\\t\");\r\n                System.out.println(rs.getObject(\"studentresult\"));\r\n            }\r\n        } catch (SQLException throwables) {\r\n            throwables.printStackTrace();\r\n        }\r\n        finally {\r\n            try {\r\n                // 关闭连接\r\n                JdbcUtils.releaseBD(connection,rs,pst);\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n> 防sql注入\r\n\r\n```Java\r\nimport java.sql.*;\r\n\r\npublic class TestPreventSQLInjection {\r\n    public static void main(String[] args) {\r\n        // 账号密码必须正确才能登录\r\n        login(\" addcad\' or \'1=1\",\"dascdd \'or\' 1=1\");\r\n    }\r\n    public static void login(String usrN ,String pwd){\r\n        ResultSet rs = null;\r\n        Connection connection = null;\r\n        PreparedStatement pst = null;\r\n        try {\r\n            // 连接数据库\r\n            connection = JdbcUtils.connectBD();\r\n            // 查询sql语句\r\n            String testQuerySql = \"select * from `user` where `user_id` = ? AND `pwd` = ?\";\r\n\r\n            pst = connection.prepareStatement(testQuerySql);  // 预编译会将转义字符全部忽略，故无法进行sql字符\r\n            pst.setString(1,usrN);\r\n            pst.setString(2,pwd);\r\n\r\n            rs = pst.executeQuery();\r\n\r\n            if (rs.next()){\r\n                System.out.println(\"登录成功！\");\r\n            }\r\n            else\r\n                System.out.println(\"账号或密码错误！\");\r\n\r\n        } catch (SQLException throwables) {\r\n            throwables.printStackTrace();\r\n        }\r\n        finally {\r\n            try {\r\n                // 关闭连接\r\n                JdbcUtils.releaseBD(connection,rs,pst);\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### 10.5 事务\r\n\r\n> 事务的ACID准则\r\n\r\n原子性：\r\n\r\n一致性：\r\n\r\n隔离性：\r\n\r\n持久性：\r\n\r\n> JDBC 事务处理\r\n\r\n```Java\r\nimport JDBC.demo02.utils.JdbcUtils;\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.SQLException;\r\n\r\npublic class TestTransaction01 {\r\n    public static void main(String[] args) {\r\n        Connection connection = null;\r\n        PreparedStatement pst = null;\r\n        try {\r\n            connection = JdbcUtils.connectBD();\r\n            // 关闭自动提交\r\n            connection.setAutoCommit(false);\r\n\r\n            String ATrans = \"UPDATE bank SET money = money - 1000 WHERE account = \'A\'\";\r\n            String toB = \"UPDATE bank SET money = money + 1000 WHERE account = \'B\'\";\r\n\r\n            pst = connection.prepareStatement(ATrans);\r\n            pst.executeUpdate();\r\n\r\n            int a = 1/0;\r\n\r\n            pst = connection.prepareStatement(toB);\r\n            pst.executeUpdate();\r\n\r\n            // 事务提交\r\n            connection.commit();\r\n            System.out.println(\"转账成功\");\r\n\r\n\r\n        } catch (SQLException throwables) {\r\n            try {\r\n\r\n                assert connection != null;\r\n                // 如果事务失败回滚（不显示说明也会执行回滚）\r\n                connection.rollback();\r\n            } catch (SQLException e) {\r\n                e.printStackTrace();\r\n            }\r\n            throwables.printStackTrace();\r\n        }finally {\r\n            try {\r\n                JdbcUtils.releaseBD(connection,null,pst);\r\n            } catch (SQLException throwables) {\r\n                throwables.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### 10.6数据库连接池\r\n\r\n#### 1. 数据连接池\r\n\r\n##### 为什么使用数据库连接池\r\n\r\n数据库连接是一种关键的有限的昂贵的资源，这一点在多用户的网页应用程序中体现得尤为突出。 一个数据库连接对象均对应一个物理数据库连接，每次操作都打开一个物理连接，使用完都关闭连接，这样造成系统的性能低下。\r\n\r\n执行一个SQL命令，如果不使用连接池，需要经过的流程\r\n\r\n1. TCP建立连接的三次握手\r\n2. MySQL认证的三次握手\r\n3. 真正的SQL执行\r\n4. MySQL的关闭\r\n5. TCP的四次握手关闭\r\n\r\n缺点：\r\n\r\n- 网络IO较多\r\n- 数据库的负载较高\r\n- 响应时间较长及QPS较低\r\n- 应用频繁的创建连接和关闭连接，导致临时对象较多，GC频繁\r\n- 在关闭连接后，会出现大量TIME_WAIT 的TCP状态（在2个MSL之后关闭）\r\n\r\n使用数据库连接池后执行SQL语句：第一次访问的时候，需要建立连接。 但是之后的访问，均会复用之前创建的连接，直接执行SQL语句。\r\n\r\n优点：\r\n\r\n- 较少了网络开销\r\n- 系统的性能会有一个实质的提升\r\n- 没了麻烦的TIME_WAIT状态\r\n\r\n##### 什么是数据库连接池\r\n\r\n为解决上述问题，可以采用数据库连接池技术。数据库连接池的基本思想就是为数据库连接建立一个“缓冲池”。预先在缓冲池中放入一定数量的连接，当需要建立数据库连接时，只需从“缓冲池”中取出一个，使用完毕之后再放回去。我们可以通过设定连接池最大连接数来防止系统无尽的与数据库连接。更为重要的是我们可以通过连接池的管理机制监视数据库的连接的数量p使用情况，为系统开发p测试及性能调整提供依据。\r\n\r\n##### 数据库连接池工作原理\r\n\r\n- 连接池的建立\r\n\r\n  一般在系统初始化时，连接池会根据系统配置建立，并在池中创建了几个连接对象，以便使用时能从连接池中获取。连接池中的连接不能随意创建和关闭，这样避免了连接随意建立和关闭造成的系统开销。\r\n\r\n- 连接池中连接的使用管理\r\n\r\n  连接池管理策略是连接池机制的核心，连接池内连接的分配和释放对系统的性能有很大的影响。其管理策略是：\r\n\r\n  当客户请求数据库连接时，首先查看连接池中是否有空闲连接，如果存在空闲连接，则将连接分配给客户使用；如果没有空闲连接，则查看当前所开的连接数是否已经达到最大连接数，如果没达到就重新创建一个连接给请求的客户；如果达到就按设定的最大等待时间进行等待，如果超出最大等待时间，则抛出异常给客户。\r\n\r\n  当客户释放数据库连接时，先判断该连接的引用次数是否超过了规定值，如果超过就从连接池中删除该连接，否则保留为其他客户服务。\r\n\r\n  该策略保证了数据库连接的有效复用，避免频繁的建立、释放连接所带来的系统资源开销。\r\n\r\n- 连接池的关闭\r\n\r\n  当应用程序退出时，关闭连接池中所有的连接，释放连接池相关的资源，该过程正好与创建相反。\r\n\r\n#### 2.常用JDBC连接池\r\n\r\n##### DBCP\r\n\r\n需要Commons-dbcp.jar和Commons-pool.jar\r\n\r\n1. 配置文件dbcp-config.properties\r\n\r\n   ```bash\r\n   # DBCP 数据库连接池配置文件\r\n   driver=com.mysql.jdbc.Driver\r\n   url = jdbc:mysql://localhost:3306/school1?useUnicode=true&characterEncoding=utf8&useSSL=false\r\n   userName = root\r\n   passWord = 123456\r\n   # 初始化连接池大小\r\n   initialSize = 10\r\n   # 最大连接数 DBCP2.xx为max\r\n   maxActive = 40\r\n   # 最大和最小空闲连接数\r\n   minIdle = 5\r\n   maxIdle = 20\r\n   # 最大等待时延ms\r\n   maxWait=30000\r\n   ```\r\n\r\n2. 工具类配置\r\n\r\n\r\n   ```Java\r\n   import JDBC.demo02.utils.JdbcUtils;\r\n   import org.apache.commons.dbcp.BasicDataSource;\r\n   import org.apache.commons.dbcp.BasicDataSourceFactory;\r\n   \r\n   import javax.sql.DataSource;\r\n   import java.io.InputStream;\r\n   import java.sql.*;\r\n   import java.util.Properties;\r\n   \r\n   public class DbpcUtils {\r\n       private static BasicDataSource bds = new BasicDataSource();\r\n       private static DataSource ds = null;\r\n   \r\n       static {\r\n   //        DataSourceConfig();\r\n   \r\n           try {\r\n               // 加载连接池配置\r\n               InputStream in = JdbcUtils.class.getClassLoader().getResourceAsStream(\"dbcp-config.properties\");\r\n               Properties properties = new Properties();\r\n               properties.load(in);\r\n               // 创建数据源BasicDataSourceFactory.createDataSource()\r\n               ds = BasicDataSourceFactory.createDataSource(properties);\r\n           } catch (Exception e) {\r\n               e.printStackTrace();\r\n           }\r\n       }\r\n   \r\n           // 连接数据库\r\n           public static Connection connectDB () throws SQLException {\r\n               return ds.getConnection();\r\n           }\r\n   \r\n           // 释放资源\r\n           public static void release (Connection connection, ResultSet resultSet, Statement...statements) throws\r\n           SQLException {\r\n               if (connection != null)\r\n                   connection.close();\r\n               if (resultSet != null)\r\n                   resultSet.close();\r\n   \r\n               for (Statement statement : statements) {\r\n                   if (statement != null)\r\n                       statement.close();\r\n               }\r\n           }\r\n   \r\n           //以代码形式，设置数据源各属性值\r\n           private static void DataSourceConfig () {\r\n               bds.setDriverClassName(\"com.mysql.jdbc.Driver\");\r\n               bds.setUsername(\"root\");\r\n               bds.setPassword(\"123456\");\r\n               bds.setUrl(\"jdbc:mysql://localhost:3306/school1?useUnicode=true&characterEncoding=utf-8&useSSL=false\");\r\n               bds.setInitialSize(20);\r\n               bds.setMaxActive(80);\r\n               bds.setMaxIdle(40);\r\n               bds.setMinIdle(20);\r\n               bds.setMaxWait(6000);\r\n           }\r\n       }\r\n   ```\r\n\r\n##### C3p0\r\n\r\n需要包mchange-commons-java-0.2.19.jar，c3p0-0.9.5.5.jar\r\n\r\n- 配置文件c3p0-config.xml\r\n\r\n  ```xml\r\n  <?xml version=\"1.0\" encoding=\"utf-8\" ?>\r\n  <c3p0-config>\r\n     <!-- 使用默认的配置读取连接池对象 -->\r\n     <default-config>\r\n        <!--  连接参数 -->\r\n        <property name=\"driverClass\">com.mysql.jdbc.Driver</property>\r\n        <property name=\"jdbcUrl\">jdbc:mysql://localhost:3306/school1</property>\r\n        <property name=\"user\">root</property>\r\n        <property name=\"password\">123456</property>\r\n  \r\n        <!-- 连接池参数 -->\r\n        <!--初始化的申请的连接数量-->\r\n        <property name=\"initialPoolSize\">5</property>\r\n        <!--最大的连接数量-->\r\n        <property name=\"maxPoolSize\">10</property>\r\n        <!--连接超时时间-->\r\n        <property name=\"checkoutTimeout\">3000</property>\r\n     </default-config>\r\n  \r\n     <named-config name=\"otherc3p0\">\r\n        <!--  连接参数 -->\r\n        <property name=\"driverClass\">com.mysql.jdbc.Driver</property>\r\n        <property name=\"jdbcUrl\">jdbc:mysql://127.0.0.1:3306/test</property>\r\n        <property name=\"user\">root</property>\r\n        <property name=\"password\">123456</property>\r\n  \r\n        <!-- 连接池参数 -->\r\n        <property name=\"initialPoolSize\">5</property>\r\n        <property name=\"maxPoolSize\">8</property>\r\n        <property name=\"checkoutTimeout\">1000</property>\r\n     </named-config>\r\n  </c3p0-config>\r\n  ```\r\n\r\n- 工具类配置\r\n\r\n```Java\r\n  import 	\r\n  \r\n  public class C3p0Utils {\r\n      private static ComboPooledDataSource cpds = new ComboPooledDataSource();// ComboPooledDataSource()内可指定连接池的配置方案，例如使用方法“Mysql”则为，ComboPooledDataSource(\"Mysql\")\r\n  \r\n  \r\n  //       static{\r\n  //        try {\r\n  //            DataSourceConfig();\r\n  //        } catch (PropertyVetoException e) {\r\n  //            e.printStackTrace();\r\n  //        }\r\n  //        }\r\n  \r\n      public static Connection getConnection() throws SQLException {\r\n          return cpds.getConnection();\r\n      }\r\n      // 释放资源\r\n      public static void release (Connection connection, ResultSet resultSet, Statement...statements) throws\r\n              SQLException {\r\n          if (connection != null)\r\n              connection.close();\r\n          if (resultSet != null)\r\n              resultSet.close();\r\n          for (Statement statement : statements) {\r\n              if (statement != null)\r\n                  statement.close();\r\n          }\r\n      }\r\n  \r\n      //以代码形式，设置数据源各属性值\r\n      private static void DataSourceConfig () throws PropertyVetoException {\r\n         cpds.setDriverClass(\"com.mysql.jdbc.Driver\");\r\n         cpds.setUser(\"root\");\r\n         cpds.setPassword(\"123456\");\r\n         cpds.setJdbcUrl(\"jdbc:mysql://localhost:3306/school1?useUnicode=true&characterEncoding=utf-8&useSSL=false\");\r\n         cpds.setInitialPoolSize(20);\r\n         cpds.setMaxPoolSize(80);\r\n         cpds.setMinPoolSize(20);\r\n         cpds.setMaxIdleTime(6000);\r\n      }\r\n  }\r\n  ```\r\n\r\n  [详解C3P0（数据库连接池） - 菜鸟++ - 博客园 (cnblogs.com)](https://www.cnblogs.com/keystone/p/12740309.html)\r\n\r\n',0,31,0,'javascript,java',1630266608228,1630269245690);
/*!40000 ALTER TABLE `question` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `user`
--

DROP TABLE IF EXISTS `user`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE `user` (
  `id` int NOT NULL AUTO_INCREMENT,
  `account_id` varchar(50) DEFAULT NULL,
  `token` char(36) DEFAULT NULL,
  `gmt_create` bigint DEFAULT NULL,
  `gmt_modify` bigint DEFAULT NULL,
  `name` varchar(50) DEFAULT NULL,
  `bio` varchar(256) DEFAULT NULL,
  `avatar_url` varchar(100) DEFAULT NULL,
  `unread` int NOT NULL DEFAULT '0',
  PRIMARY KEY (`id`),
  UNIQUE KEY `user_token_uindex` (`token`),
  UNIQUE KEY `user_account_id_uindex` (`account_id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `user`
--

LOCK TABLES `user` WRITE;
/*!40000 ALTER TABLE `user` DISABLE KEYS */;
INSERT INTO `user` VALUES (1,'gitee7980263','cc14c252845741c693918cf24243a3d3',1630012628327,1630012628327,'hhhha',NULL,'https://gitee.com/assets/no_portrait.png',0),(2,'gitee8756447','ecd5fb55217b420b905e7ed52cba0f79',1630014213012,1630014213012,'胡爱辉',NULL,'https://portrait.gitee.com/uploads/avatars/user/2918/8756447_huaihui_1629364471.png',0),(3,'giteenull','96b21bf681864579a76ed8dfd780d114',1630078624741,1630078624741,NULL,NULL,NULL,0);
/*!40000 ALTER TABLE `user` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2021-09-09  0:39:43
